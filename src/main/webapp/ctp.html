<!DOCTYPE html>
<html>
<head>
    <title>Cryptotrading Places</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="jquery/jquery.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <script src="jquery/jquery-2.1.3.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/bootstrap-select.min.js"></script>
    <script src="angular/angular.min.js"></script>
</head>
<body>

<div ng-app="cryptoTrading" ng-controller="cryptoTradingController">
    <div align="center"><h1>Crypto trading places (Handel)</h1></div>

    <div align="center">
        <h3>
            {{tradingAsText}} : {{currentRate}}
        </h3>

    </div>

    <div align="center">
        <div class="btn-group btn-toolbar" role="group">
            <button type="button" class="btn btn-primary"> Grafiek</button>
            <button type="button" class="btn btn-primary" ng-click="getWallet()"> Wallet</button>
            <button type="button" class="btn btn-primary" ng-click="getOrders()"> Orders</button>
        </div>
    </div>

    <div ng-show="showWallet" align="center">
        <h4>Wallet</h4>
        <table>
            <tr>
                <td width="200"><h4>Munten  :</h4></td>
                <td><h4>{{ wallet.coins }} {{ trading.tradePair.currency.code }}</h4></td>
            </tr>
            <tr>
                <td><h4>Cryptocoins :</h4></td>
                <td><h4>{{ wallet.cryptoCoins }} {{ trading.tradePair.cryptoCurrency.code }}</h4></td>
            </tr>
        </table>
    </div>

    <div ng-show="showOrders" align="center">
        <h4>Market Orders</h4>

        <table>
            <tr>
                <th>Datum en tijd</th>
                <th>Order tyoe</th>
                <th>Index</th>
                <th>Order nummer</th>
                <th>Munten</th>
                <th>Crypto munten</th>
                <th>Koers</th>
                <th>Commissie</th>
                <th>Status</th>
            </tr>
            <tr ng-repeat="order in marketOrders">
                <td width="120">{{ order.timestamp | date: "dd-M-yyyy - hh:mm:ss uur" }}</td>
                <td width="100">{{ order.orderType }}</td>
                <td width="100">{{ order.index }}</td>
                <td width="200">{{ order.orderReference }}</td>
                <td width="100">{{ order.coins }}</td>
                <td width="100">{{ order.cryptoCoins }}</td>
                <td width="100">{{ order.exchangeRate }}</td>
                <td width="100">{{ order.fee }}</td>
                <td width="100">{{ order.status }}</td>
            </tr>
        </table>
    </div>
</div>

</body>

<script>
    var app = angular.module("cryptoTrading", []);

    app.controller("cryptoTradingController", function ($scope, $http) {

        $scope.showOrders = false;
        $scope.showWallet = false;

        // get current trading
        var promise = $http.get('rest/getCurrentTrading').
                           success(function (data) {
                           $scope.trading = data;
                      });

        // Wait until promise of getting current trade is finished.
        promise.then(function () {

            // get trading site as text
            $http.get('rest/getTradingAsStringText/' + $scope.trading.id).
                    success(function (data) {
                        $scope.tradingAsText = data;
                    });

            // get current crypto trading rate
            $http.get('rest/currentCryptoRate/' + $scope.trading.id).
                    success(function (data) {
                        $scope.currentRate = data;
                    });
        });

        // Get all market orders
        $scope.getOrders = function () {
            $scope.showOrders = true;
            $scope.showWallet = false;

            $http.get('rest/marketOrders/' + $scope.trading.id).
                    success(function (data) {
                        $scope.marketOrders = data;
                    });
        }

        // Get wallet
        $scope.getWallet = function () {
            $scope.showOrders = false;
            $scope.showWallet = true;

            $http.get('rest/getWallet/' + $scope.trading.id).
                    success(function (data) {
                        $scope.wallet = data;
                    });
        }
    })

</script>
</html>