<!DOCTYPE html>
<html>
<head>
    <title>Cryptotrading Places</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="jquery/jquery.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <script src="jquery/jquery-2.1.3.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/bootstrap-select.min.js"></script>
    <script src="angular/angular.min.js"></script>
</head>
<body>

<div ng-app="cryptoTrading" ng-controller="cryptoTradingController">
    <div align="center"><h1>Crypto trading places (Handel)</h1></div>

    <div align="center">
        <h3>
            {{tradingAsText}} : {{currentRate}}
        </h3>

    </div>

    <div align="center">
        <div class="btn-group btn-toolbar" role="group">
            <button type="button" class="btn btn-primary" ng-click="getGraph()"> Grafiek</button>
            <button type="button" class="btn btn-primary" ng-click="getWallet()"> Wallet</button>
            <button type="button" class="btn btn-primary" ng-click="getOrders()"> Orders</button>
        </div>
    </div>

    <div ng-show="showWallet" align="center">
        <h4>Wallet</h4>
        <table>
            <tr>
                <td width="200"><h4>Munten  :</h4></td>
                <td><h4>{{ wallet.coins }} {{ currency.code }}</h4></td>
            </tr>
            <tr>
                <td><h4>Cryptocoins :</h4></td>
                <td><h4>{{ wallet.cryptoCoins }} {{ cryptoCurrency.code }}</h4></td>
            </tr>
        </table>

        <h4>Wallet historie</h4>
        <table>
            <tr>
                <th width="120">Datum en tijd</th>
                <th width="120">Munten</th>
                <th width="130">Crypto munten</th>
                <th width="100">Koers</th>
                <th width="200">Totale waarde</th>
            </tr>
            <tr ng-repeat="walletHistory in walletHistories">
                <td>{{ walletHistory.timestamp | date: "dd-M-yyyy - hh:mm:ss uur" }}</td>
                <td>{{ walletHistory.coins }}</td>
                <td>{{ walletHistory.cryptoCoins }}</td>
                <td>{{ walletHistory.exchangeRate }}</td>
                <td>{{ walletHistory.totalValue }}</td>
            </tr>
        </table>
    </div>

    <div ng-show="showOrders" align="center">
        <h4>Market Orders</h4>

        <table>
            <tr>
                <th width="120">Datum en tijd</th>
                <th width="100">Order tyoe</th>
                <th width="100">Index</th>
                <th width="120">Order nummer</th>
                <th width="100">Munten</th>
                <th width="120">Crypto munten</th>
                <th width="100">Koers</th>
                <th width="100">Commissie</th>
                <th width="100">Status</th>
            </tr>
            <tr ng-repeat="order in marketOrders">
                <td>{{ order.timestamp | date: "dd-M-yyyy - hh:mm:ss uur" }}</td>
                <td>{{ order.orderType }}</td>
                <td>{{ order.index }}</td>
                <td>{{ order.orderReference }}</td>
                <td>{{ currency.symbol }} {{ order.coins }}</td>
                <td>{{ cryptoCurrency.symbol }} {{ order.cryptoCoins }}</td>
                <td>{{ order.exchangeRate }}</td>
                <td>{{ order.fee }}</td>
                <td>{{ order.status }}</td>
            </tr>
        </table>
    </div>

    <div ng-show="showGraph" align="center">
        <h4>Grafiek</h4>
    </div>

</div>

</body>

<script>
    var app = angular.module("cryptoTrading", []);

    app.controller("cryptoTradingController", function ($scope, $http) {

        $scope.showOrders = false;
        $scope.showWallet = false;
        $scope.showGraph = false;

        // get current trading
        var promise = $http.get('rest/getCurrentTrading').
                success(function (data) {
                    $scope.trading = data;
                });

        // Wait until promise of getting current trade is finished.
        promise.then(function () {

            // get trading site as text
            $http.get('rest/getTradingAsStringText/' + $scope.trading.id).
                    success(function (data) {
                        $scope.tradingAsText = data;
                    });

            // get current crypto trading rate
            $http.get('rest/currentCryptoRate/' + $scope.trading.id).
                    success(function (data) {
                        $scope.currentRate = data;
                    });

            $scope.currency = $scope.trading.tradePair.currency;
            $scope.cryptoCurrency = $scope.trading.tradePair.cryptoCurrency;
        });

        // Get all market orders
        $scope.getOrders = function () {
            $scope.showOrders = true;
            $scope.showWallet = false;
            $scope.showGraph = false;

            $http.get('rest/marketOrders/' + $scope.trading.id).
                    success(function (data) {
                        $scope.marketOrders = data;
                    });
        }

        // Get wallet
        $scope.getWallet = function () {
            $scope.showOrders = false;
            $scope.showWallet = true;
            $scope.showGraph = false;

            $http.get('rest/getWallet/' + $scope.trading.id).
                    success(function (data) {
                        $scope.wallet = data;
                    });

            $http.get('rest/getWalletHistory/' + $scope.trading.id).
                    success(function (data) {
                        $scope.walletHistories = data;
                    });
        }

        // Show graph
        $scope.getGraph = function () {
            $scope.showOrders = false;
            $scope.showWallet = false;
            $scope.showGraph = true;

        }
    })
</script>
</html>